#!/usr/bin/env nu
# Inspired by:
# From: https://morgan.cugerone.com/blog/workarounds-to-git-worktree-using-bare-repository-and-cannot-fetch-remote-branches/

# Examples of call:
# jj-clone git@github.com:name/repo.git <directory_name>
# => Clones to a <directory_name>.repo/default.git.jj directory
def main [
  url: string
  directory_name: string = ""
] {

  let dir_name = if ($directory_name | is-empty) {
    $url | path basename | str replace ".git" ".repo" 
  } else {
    $"($directory_name).repo"
  }

  mkdir $dir_name

  cd $dir_name
  jj git clone --colocate $url default.git.jj
}

